var e=Object.assign;import{m as t,a as l,b as r,c as a,l as n,r as s,I as i,R as c,C as m,B as o,o as d,F as u,T as E,d as p,S as h,D as g,e as v,f,g as y,h as k}from"./vendor.734ec3b8.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(l){const r=new URL(e,location),a=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((l,n)=>{const s=new URL(e,r);if(self[t].moduleMap[s])return l(self[t].moduleMap[s]);const i=new Blob([`import * as m from '${s}';`,`${t}.moduleMap['${s}']=m;`],{type:"text/javascript"}),c=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(i),onerror(){n(new Error(`Failed to import: ${e}`)),a(c)},onload(){l(self[t].moduleMap[s]),a(c)}});document.head.appendChild(c)})),self[t].moduleMap={}}}("/uitestweb/assets/");const b="http://talos30364-prelb.o2athena.svc.ht1.n.jd.local",w={task:`${b}/api/tasks`,diff:`${b}/api/v1/diff`,devices:`${b}/api/getDevices`,snapshot:`${b}/api/snapshot`};var I=new class{constructor(){this.list=[],this.isLoading=!0,this.devices=[],t(this)}fetchList(t={}){this.isLoading=!0,l.get(w.task,e(e({},t),{timeout:5e3})).then(r("success",(e=>{this.list=e.data,this.isLoading=!1})),r("error",(()=>{a.error("Server error!"),this.isLoading=!1})))}addTask(t,n){l({method:"post",url:w.task,data:e({creator:"lijie67",systemWebview:0},t)}).then(r("success",(e=>{const{data:t}=e;0===t.code&&(a.success("创建成功!"),this.fetchList(),n&&n())})),r("error",(()=>{a.error("Server error!")})))}update(t,n,s){l({method:"put",url:`${w.task}/${t}`,data:e(e({},n),{status:3})}).then(r("success",(e=>{console.log(e),a.success("创建成功!"),this.fetchList(),s&&s()})),r("error",(()=>{a.error("Server error!")})))}getDevices(){l.get(w.devices).then(r("success",(e=>{const t=e.data;if(0===t.code){const e=n.filter(t.result,(e=>{const t="Ios"===e.platform,l=e.deviceName.indexOf("合规测试机")<0;return!t&&l}));this.devices=e}})),r("error",(()=>{a.error("Server error!")})))}renderOrigin(e){return l({method:"post",url:w.snapshot,data:{url:e}})}};const L=t=>{const{data:r}=t;if(!r)return null;console.log(r);const n=s.useMemo((()=>{const t=[],n=JSON.parse(r.result);for(const l in n.details)t.push(e({key:l},n.details[l]));return t.map((e=>{var t,n,d,u;return s.createElement("div",{key:e.key},s.createElement("h2",null,e.key),e.errormsg?s.createElement("h3",null,e.errormsg):s.createElement(s.Fragment,null,s.createElement("h3",null,"解屏"),s.createElement(i.PreviewGroup,null,e.images.map(((e,t)=>s.createElement(i,{key:t,width:50,src:e})))),s.createElement("h3",null,"长图"),s.createElement(c,{gutter:16},s.createElement(m,null,s.createElement(i,{width:100,src:e.merge})),s.createElement(m,null,s.createElement(i,{width:100,src:r.origin})),s.createElement(m,null,s.createElement(i,{width:100,src:null==(t=e.diff)?void 0:t.url})),s.createElement(m,null,s.createElement("p",null,"templateMath:",null==(n=e.diff)?void 0:n.templateMath),s.createElement("p",null,"pixelsDiff:",1-(null==(d=e.diff)?void 0:d.pixelsDiff)),s.createElement("p",null,"threshold:",null==(u=e.diff)?void 0:u.threshold),s.createElement(o,{onClick:()=>{var t,n,s,i;t=r._id,n=e.key,s=r.origin,i=e.merge,l({method:"post",url:w.diff,data:{taskId:t,device:n,origin:s,template:i,threshold:.6}}).then((e=>{console.log(e),a.success("diff success")}))}},"diff")))))}))}),[r]);return s.createElement(s.Fragment,null,n)},{Column:x}=E;var C=d((()=>{const{isLoading:t,list:l}=I,[r,a]=s.useState(null),[n,i]=s.useState(!1),[c,m]=s.useState(null),[d]=u.useForm(),f=()=>{i(!1),m(null)};return s.useEffect((()=>{I.fetchList()}),[]),s.createElement(s.Fragment,null,s.createElement(E,{rowKey:"_id",loading:t,dataSource:l,expandable:{expandedRowRender:t=>{const l=JSON.parse(t.result),r=[];for(const a in l.details)r.push(e({key:a},l.details[a]));return r.map((e=>s.createElement("p",{key:e.key},e.key,":",e.errormsg)))},rowExpandable:e=>1===e.status},pagination:{defaultPageSize:5}},s.createElement(x,{title:"name",dataIndex:"name",key:"name"}),s.createElement(x,{title:"url",dataIndex:"activityUrl",key:"activityUrl",render:e=>s.createElement("a",{href:e,target:"_blank"},e)}),s.createElement(x,{title:"origin",dataIndex:"origin",key:"origin"}),s.createElement(x,{title:"deviceCount",dataIndex:"deviceList",key:"deviceList",render:e=>s.createElement("span",null,e.length)}),s.createElement(x,{title:"slideNum",dataIndex:"slideNum",key:"slideNum"}),s.createElement(x,{title:"status",dataIndex:"status",key:"status",render:e=>1===e?s.createElement(p,{color:"green"},"成功"):2===e?s.createElement(p,{color:"red"},"失败"):3===e?s.createElement(p,{color:"blue"},"执行中"):void 0}),s.createElement(x,{title:"操作",render:(e,t)=>s.createElement(h,null,s.createElement(o,{type:"link",disabled:3===t.status,onClick:()=>{(e=>{a(e)})(t)}},"详细"),s.createElement(o,{type:"link",disabled:3===t.status,onClick:()=>{(e=>{i(!0),m(e)})(t)}},"修改"))})),s.createElement(g,{title:null==c?void 0:c.name,width:720,closable:!1,onClose:f,visible:n,footer:s.createElement("div",{style:{textAlign:"right"}},s.createElement(o,{onClick:f,style:{marginRight:8}},"Cancel"),s.createElement(o,{type:"primary",onClick:()=>{d.submit()}},"Submit"))},c&&s.createElement(u,{layout:"vertical",hideRequiredMark:!0,form:d,initialValues:c,onFinish:e=>{const t=c._id;I.update(t,e,f)}},s.createElement(u.Item,{label:"名称",name:"name",rules:[{required:!0,message:"Please input name!"}]},s.createElement(v,null)),s.createElement(u.Item,{label:"原图地址",name:"origin"},s.createElement(v,null)))),s.createElement(L,{data:r}))}));const{Option:S}=f;var R=d((()=>{const[e]=u.useForm(),{devices:t}=I,[l,r]=s.useState(!1),[n,i]=s.useState(!1),d=()=>{i(!1)},E=s.useMemo((()=>t.map((e=>s.createElement(S,{key:e.serial,value:e.serial},e.deviceName," (",e.resolution,")")))),[t]);return s.createElement("div",{className:"add-tasks"},s.createElement(o,{type:"primary",size:"large",onClick:()=>{i(!0)}},"添加任务"),s.createElement(g,{title:"创建测试任务",width:500,closable:!1,onClose:d,visible:n,placement:"left",footer:s.createElement("div",{style:{textAlign:"right"}},s.createElement(o,{onClick:d,style:{marginRight:20}},"关闭"),s.createElement(o,{type:"primary",onClick:()=>{e.submit()}},"提交"))},s.createElement(u,{form:e,layout:"vertical",hideRequiredMark:!0,onFinish:e=>{I.addTask(e,(()=>d()))},initialValues:{activityUrl:"https://m.jd.com",slideNum:5}},s.createElement(u.Item,{label:"名称",name:"name",rules:[{required:!0,message:"Please input name!"}]},s.createElement(v,null)),s.createElement(u.Item,{label:"活动链接",name:"activityUrl",rules:[{required:!0,message:"Please input url"}]},s.createElement(v,null)),s.createElement(c,null,s.createElement(m,{span:20},s.createElement(u.Item,{extra:"填写图片地址或通过无头浏览器生成活动图",label:"对比图片",name:"origin"},s.createElement(v,null))),s.createElement(m,{span:4},s.createElement(u.Item,{label:" "},s.createElement(o,{loading:l,onClick:()=>{const t=e.getFieldValue("activityUrl");t?(r(!0),I.renderOrigin(t).then((({data:t})=>{0===t.code&&e.setFieldsValue({origin:t.result}),r(!1)}),(()=>{a.error("Server error"),r(!1)}))):a.error("先填活动链接")},type:"primary"},"生成")))),s.createElement(u.Item,{label:"选择机型",name:"deviceList",rules:[{required:!0,message:"Please select"}]},t.length?s.createElement(f,{mode:"multiple",placeholder:"选择机型"},E):s.createElement(o,{type:"primary",onClick:()=>{I.getDevices()}},"选择")),s.createElement(u.Item,{label:"滑动次数",name:"slideNum"},s.createElement(y,{min:2,max:50})))))}));const F=()=>s.createElement("div",{className:"main-content"},s.createElement(R,null),s.createElement(C,null));k.render(s.createElement(s.StrictMode,null,s.createElement(F,null)),document.getElementById("root"));
